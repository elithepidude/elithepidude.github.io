<!DOCTYPE html>
<html>
<head>
<title>txt2img</title>
<link href="style.css" rel="stylesheet" type="text/css" media="all">
</head>
<body>

<h1>text to image</h1>

<!-- First Input and Button -->
<h2>Comic Sans</h2>
<input id="sigma" type="text" name="fname">
<button onclick="myFunction();">Update Canvas</button></br>
<canvas id="myCanvas" width="320" height="64">nuh uh</canvas>

<hr>

<!-- Second Input and Buttons -->
<h2>CP437</h2>
<input id="sigma2" type="text" name="fname">
<button onclick="myFunctionTwo();">Update Canvas</button></br>
<select id="dropdown" name="options" onchange="yeah()">
  <option value=6>6x6</option>
  <option value=8>8x8</option>
  <option value=16>16x16</option>
</select></br>
<input type="range" id="slider1" name="slider" min="1" max="8" value="1" oninput="updateValue(this.value)"><txt id="t1">1</txt></br>
<input type="range" id="slider2" name="slider" min="1" max="8" value="1" oninput="updateValue2(this.value)"><txt id="t2">1</txt></br>
<canvas id="c0" width="48" height="48">nuh uh</canvas>

<script>
var co = ["#f00", "#0f0", "#00f", "#0ff", "#f0f", "#ff0"];
var iv = ["#0ff", "#f0f", "#ff0", "#f00", "#0f0", "#00f"];
var ltr = " ☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ";

function randomInt(max) {
  return Math.floor(Math.random() * max);
}

function updateValue(a) {
  document.getElementById("t1").textContent = a;
  document.getElementById("c0").width = document.getElementById("dropdown").value * a * 4;
  change("c0", document.getElementById("sigma2").value, document.getElementById("dropdown").value);
}

function updateValue2(a) {
  document.getElementById("t2").textContent = a;
  document.getElementById("c0").height = document.getElementById("dropdown").value * a * 4;
  change("c0", document.getElementById("sigma2").value, document.getElementById("dropdown").value);
}

function myFunction() {
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
  var j = randomInt(6); // Fix: Ensure randomInt uses the correct maximum
  ctx.fillStyle = co[j];
  ctx.fillRect(0, 0, c.width, c.height);
  ctx.fillStyle = iv[j];
  ctx.font = "32px Comic Sans MS";
  ctx.fillText(document.getElementById("sigma").value, 8, 32);
}

function yeah() {
  updateValue(document.getElementById("slider1").value)
  updateValue2(document.getElementById("slider2").value)
  change("c0", document.getElementById("sigma2").value, document.getElementById("dropdown").value);
}

function change(canvasId, txt, size) {
  var c2 = document.getElementById(canvasId);
  var ctx2 = c2.getContext("2d");
  var stringy = txt;
  var txtspr = new Image();
  txtspr.src = "https://elithepidude.github.io/cp437_" + size + "x" + size + ".png";

  txtspr.onload = function () { // Fix: Ensure image is loaded before drawing
    ctx2.fillStyle = "#888";
    ctx2.clearRect(0, 0, c2.width, c2.height);
    ctx2.fillStyle = "#000";

    var i = 0;
    var x = 0;
    var y = 0;
    while (i < stringy.length) {
      var t = ltr.indexOf(stringy[i]);
      if (t >= 0) { // Fix: Ensure character exists in the `ltr` string
        ctx2.drawImage(txtspr, ((t % 16) * size), Math.floor(t / 16) * size, size, size, size * x, size * y, size, size);
      }
      x += 1;
      if (x * size > c2.width - size || (x * size > c2.width - (size*3) && stringy[i] == " ")) {
        x = 0;
        y += 1;
      }
      i += 1;
    }
  };
}

function myFunctionTwo(a,b) {
  updateValue(document.getElementById("slider1").value)
  updateValue2(document.getElementById("slider2").value)
  change("c0", document.getElementById("sigma2").value, document.getElementById("dropdown").value);
}
</script>

</body>
</html>
